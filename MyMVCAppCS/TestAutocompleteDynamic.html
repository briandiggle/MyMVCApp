<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <link type="text/css" href="/Content/themes/base/jquery.ui.all.css" rel="Stylesheet" />
        <script type="text/javascript" src="/Scripts/jquery-2.1.1.js"></script>
        <script type="text/javascript" src="/Scripts/jquery-ui-1.10.4.js"></script>
        <title></title>
    </head>
<body>
    <script type="text/javascript">


        $(function() {
            $(document).on("keydown.autocomplete", ".suggestme", function(e) {

                $(this).autocomplete({
                    source: "/Walks/MarkerSuggestions",
                    minLength: 2,
                    select: function (event, ui) {
                        var imagenumber = extractimagenumber(event.target.id);
                        var markerid = extractmarkerid(ui.item.value);
                        $("#markerid" + imagenumber).val(markerid);
                    }
                });

            });

            $().ready(function() {
                $("#CreateImages").click(function () {
                    for (var imagenumber = 1; imagenumber < 10; imagenumber++) {
                        $("#target").append('<input type="text" name="markername' + imagenumber + '" id="markername' + imagenumber + '" class="suggestme" />');
                        $("#target").append('<input type="hidden" name="markerid' + imagenumber + '" id="markerid' + imagenumber + '" />');
                    }

                });
            });
        });

        function extractmarkerid(selectedmarker) {
            if (selectedmarker.indexOf("|") > 0) {
                var myloc = selectedmarker.indexOf("|");
                return selectedmarker.substring(myloc + 1).trim();
            }
            return "";
        }

        function extractimagenumber(markertextboxname) {
            return markertextboxname.replace("markername", "");
        }

    </script>

    <div id="target"></div>
   
    <button id="CreateImages">CreateImages</button>
    
</body>
</html>
